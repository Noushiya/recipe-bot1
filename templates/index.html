<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Finder Bot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body.light-mode { background-color: #f9fafb; color: #1f2937; }
    body.dark-mode { background-color: #1f2937; color: #f9fafb; }
    #chatbox::-webkit-scrollbar { width: 8px; }
    #chatbox::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
    .typing-dots::after {
      content: '...';
      animation: blink 1s steps(5, start) infinite;
    }
    @keyframes blink {
      to { visibility: hidden; }
    }
    .markdown strong { font-weight: bold; }
    .markdown ul { list-style-type: disc; padding-left: 20px; margin-top: 5px; }
    .markdown li { margin-bottom: 4px; }
  </style>
</head>
<body class="flex items-center justify-center h-screen px-2 transition-colors duration-500 light-mode">

  <!-- Chat Container -->
  <div class="w-full max-w-md max-h-[75vh] bg-white dark:bg-gray-800 rounded-3xl shadow-xl flex flex-col overflow-hidden transition-colors duration-500">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-green-400 to-lime-500 text-white text-center p-4 text-2xl font-bold flex justify-between items-center">
      <span>üçΩ Recipe Finder Bot</span>
      <button onclick="toggleDarkMode()" class="text-sm bg-white bg-opacity-30 px-2 py-1 rounded">Toggle Mode</button>
    </div>
    
    <!-- Chat Messages -->
    <div id="chatbox" class="flex-1 overflow-y-auto p-4 space-y-3 markdown"></div>

    <!-- Input Area -->
    <div class="flex border-t dark:border-gray-700">
      <input id="message" type="text" placeholder="Ask for recipes..."
        class="flex-1 p-3 rounded-bl-3xl outline-none text-gray-700 dark:text-white dark:bg-gray-700">
      <button onclick="sendMessage()"
        class="bg-green-500 hover:bg-green-600 text-white px-6 rounded-br-3xl transition-all">Send</button>
    </div>

  </div>

<script>
function toggleDarkMode() {
  const body = document.body;
  if (body.classList.contains('light-mode')) {
    body.classList.remove('light-mode');
    body.classList.add('dark-mode');
  } else {
    body.classList.remove('dark-mode');
    body.classList.add('light-mode');
  }
}

async function sendMessage() {
  const messageInput = document.getElementById("message");
  const chatbox = document.getElementById("chatbox");
  const message = messageInput.value.trim();
  if (!message) return;

  // Display user message
  chatbox.innerHTML += `
    <div class="flex justify-end">
      <div class="bg-green-200 px-3 py-2 rounded-2xl max-w-xs text-right">${message}</div>
    </div>
  `;
  messageInput.value = "";
  scrollToBottom();

  // Show typing indicator
  const typingId = "typing";
  chatbox.innerHTML += `
    <div id="${typingId}" class="flex justify-start">
      <div class="bg-gray-200 px-3 py-2 rounded-2xl max-w-xs text-left typing-dots">Typing</div>
    </div>
  `;
  scrollToBottom();

  // Fetch bot reply
  const response = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  });
  const data = await response.json();

  // Remove typing indicator
  document.getElementById(typingId).remove();

  // Display bot reply (Markdown rendering: line breaks + bullets)
  const reply = data.reply.replace(/\n/g, "<br>");
  chatbox.innerHTML += `
    <div class="flex justify-start">
      <div class="bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 px-3 py-2 rounded-2xl max-w-xs text-left">${reply}</div>
    </div>
  `;
  scrollToBottom();
}

function scrollToBottom() {
  const chatbox = document.getElementById("chatbox");
  chatbox.scrollTop = chatbox.scrollHeight;
}

// Enter key triggers send
document.getElementById("message").addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();  // Prevent new line
    sendMessage();
  }
});
</script>

</body>
</html>
